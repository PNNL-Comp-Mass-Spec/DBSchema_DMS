/****** Object:  View [dbo].[V_Dataset_QC_Metrics_Detail_Report] ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

CREATE VIEW [dbo].[V_Dataset_QC_Metrics_Detail_Report]
AS
SELECT DISTINCT
    [Instrument Group],
    Instrument,
    Acq_Time_Start,
    Dataset_ID,
    Dataset,
    [Dataset Folder Path],
    [QC Metric Stats],
    Quameter_Job,
    XIC_WideFrac + '| Fraction of precursor ions accounting for the top half of all peak width' AS XIC_WideFrac,
    XIC_FWHM_Q1 + ' seconds| 25%ile of peak widths for the wide XICs' AS XIC_FWHM_Q1,
    XIC_FWHM_Q2 + ' seconds| 50%ile of peak widths for the wide XICs' AS XIC_FWHM_Q2,
    XIC_FWHM_Q3 + ' seconds| 75%ile of peak widths for the wide XICs' AS XIC_FWHM_Q3,
    XIC_Height_Q2 + '| The log ratio for 50%ile of wide XIC heights over 25%ile of heights.' AS XIC_Height_Q2,
    XIC_Height_Q3 + '| The log ratio for 75%ile of wide XIC heights over 50%ile of heights.' AS XIC_Height_Q3,
    XIC_Height_Q4 + '| The log ratio for maximum of wide XIC heights over 75%ile of heights.' AS XIC_Height_Q4,
    RT_Duration + ' seconds| Highest scan time observed minus the lowest scan time observed' AS RT_Duration,
    RT_TIC_Q1 + '| The interval when the first 25% of TIC accumulates divided by RT-Duration' AS RT_TIC_Q1,
    RT_TIC_Q2 + '| The interval when the second 25% of TIC accumulates divided by RT-Duration' AS RT_TIC_Q2,
    RT_TIC_Q3 + '| The interval when the third 25% of TIC accumulates divided by RT-Duration' AS RT_TIC_Q3,
    RT_TIC_Q4 + '| The interval when the fourth 25% of TIC accumulates divided by RT-Duration' AS RT_TIC_Q4,
    RT_MS_Q1 + '| The interval for the first 25% of all MS events divided by RT-Duration' AS RT_MS_Q1,
    RT_MS_Q2 + '| The interval for the second 25% of all MS events divided by RT-Duration' AS RT_MS_Q2,
    RT_MS_Q3 + '| The interval for the third 25% of all MS events divided by RT-Duration' AS RT_MS_Q3,
    RT_MS_Q4 + '| The interval for the fourth 25% of all MS events divided by RT-Duration' AS RT_MS_Q4,
    RT_MSMS_Q1 + '| The interval for the first 25% of all MS/MS events divided by RT-Duration' AS RT_MSMS_Q1,
    RT_MSMS_Q2 + '| The interval for the second 25% of all MS/MS events divided by RT-Duration' AS RT_MSMS_Q2,
    RT_MSMS_Q3 + '| The interval for the third 25% of all MS/MS events divided by RT-Duration' AS RT_MSMS_Q3,
    RT_MSMS_Q4 + '| The interval for the fourth 25% of all MS/MS events divided by RT-Duration' AS RT_MSMS_Q4,
    MS1_TIC_Change_Q2 + '| The log ratio for 50%ile of TIC changes over 25%ile of TIC changes' AS MS1_TIC_Change_Q2,
    MS1_TIC_Change_Q3 + '| The log ratio for 75%ile of TIC changes over 50%ile of TIC changes' AS MS1_TIC_Change_Q3,
    MS1_TIC_Change_Q4 + '| The log ratio for largest TIC change over 75%ile of TIC changes' AS MS1_TIC_Change_Q4,
    MS1_TIC_Q2 + '| The log ratio for 50%ile of TIC over 25%ile of TIC' AS MS1_TIC_Q2,
    MS1_TIC_Q3 + '| The log ratio for 75%ile of TIC over 50%ile of TIC' AS MS1_TIC_Q3,
    MS1_TIC_Q4 + '| The log ratio for largest TIC over 75%ile TIC' AS MS1_TIC_Q4,
    MS1_Count + '| Number of MS spectra collected' AS MS1_Count,
    MS1_Freq_Max + ' Hz| Fastest frequency for MS collection in any minute' AS MS1_Freq_Max,
    MS1_Density_Q1 + '| 25%ile of MS scan peak counts' AS MS1_Density_Q1,
    MS1_Density_Q2 + '| 50%ile of MS scan peak counts' AS MS1_Density_Q2,
    MS1_Density_Q3 + '| 75%ile of MS scan peak counts' AS MS1_Density_Q3,
    MS2_Count + '| Number of MS/MS spectra collected' AS MS2_Count,
    MS2_Freq_Max + ' Hz| Fastest frequency for MS/MS collection in any minute' AS MS2_Freq_Max,
    MS2_Density_Q1 + '| 25%ile of MS/MS scan peak counts' AS MS2_Density_Q1,
    MS2_Density_Q2 + '| 50%ile of MS/MS scan peak counts' AS MS2_Density_Q2,
    MS2_Density_Q3 + '| 75%ile of MS/MS scan peak counts' AS MS2_Density_Q3,
    MS2_PrecZ_1 + '| Fraction of MS/MS precursors that are singly charged' AS MS2_PrecZ_1,
    MS2_PrecZ_2 + '| Fraction of MS/MS precursors that are doubly charged' AS MS2_PrecZ_2,
    MS2_PrecZ_3 + '| Fraction of MS/MS precursors that are triply charged' AS MS2_PrecZ_3,
    MS2_PrecZ_4 + '| Fraction of MS/MS precursors that are quadruply charged' AS MS2_PrecZ_4,
    MS2_PrecZ_5 + '| Fraction of MS/MS precursors that are quintuply charged' AS MS2_PrecZ_5,
    MS2_PrecZ_more + '| Fraction of MS/MS precursors that are charged higher than +5' AS MS2_PrecZ_more,
    MS2_PrecZ_likely_1 + '| Fraction of MS/MS precursors lack known charge but look like 1+' AS MS2_PrecZ_likely_1,
    MS2_PrecZ_likely_multi + '| Fraction of MS/MS precursors lack known charge but look like 2+ or higher' AS MS2_PrecZ_likely_multi,
    Quameter_Last_Affected,
    SMAQC_Job,
    C_1A + '| Fraction of peptides identified more than 4 minutes earlier than the chromatographic peak apex' AS C_1A,
    C_1B + '| Fraction of peptides identified more than 4 minutes later than the chromatographic peak apex' AS C_1B,
    C_2A + ' minutes| Time period over which 50% of peptides are identified' AS C_2A,
    C_2B + '| Rate of peptide identification during C-2A' AS C_2B,
    C_3A + ' seconds| Median peak width for all peptides' AS C_3A,
    C_3B + ' seconds| Median peak width during middle 50% of separation' AS C_3B,
    C_4A + ' seconds| Median peak width during first 10% of separation' AS C_4A,
    C_4B + ' seconds| Median peak width during last 10% of separation' AS C_4B,
    C_4C + ' seconds| Median peak width during middle 10% of separation' AS C_4C,
    DS_1A + '| Count of peptides with one spectrum / count of peptides with two spectra' AS DS_1A,
    DS_1B + '| Count of peptides with two spectra / count of peptides with three spectra' AS DS_1B,
    DS_2A + '| Number of MS1 scans taken over middle 50% of separation' AS DS_2A,
    DS_2B + '| Number of MS2 scans taken over middle 50% of separation' AS DS_2B,
    DS_3A + '| Median of MS1 max / MS1 sampled abundance' AS DS_3A,
    DS_3B + '| Median of MS1 max / MS1 sampled abundance; limit to bottom 50% of peptides by abundance' AS DS_3B,
    IS_1A + '| Occurrences of MS1 jumping >10x' AS IS_1A,
    IS_1B + '| Occurrences of MS1 falling >10x' AS IS_1B,
    IS_2 + '| Median precursor m/z for all peptides' AS IS_2,
    IS_3A + '| Count of 1+ peptides / count of 2+ peptides' AS IS_3A,
    IS_3B + '| Count of 3+ peptides / count of 2+ peptides' AS IS_3B,
    IS_3C + '| Count of 4+ peptides / count of 2+ peptides' AS IS_3C,
    MS1_1 + ' milliseconds| Median MS1 ion injection time' AS MS1_1,
    MS1_2A + '| Median S/N value for MS1 spectra from run start through middle 50% of separation' AS MS1_2A,
    MS1_2B + '| Median TIC value for identified peptides from run start through middle 50% of separation' AS MS1_2B,
    MS1_3A + '| Dynamic range estimate using 95th percentile peptide peak apex intensity / 5th percentile' AS MS1_3A,
    MS1_3B + '| Median peak apex intensity for all peptides' AS MS1_3B,
    MS1_5A + ' Th| Median of precursor mass error' AS MS1_5A,
    MS1_5B + ' Th| Median of absolute value of precursor mass error' AS MS1_5B,
    MS1_5C + ' ppm| Median of precursor mass error' AS MS1_5C,
    MS1_5D + ' ppm| Interquartile distance in ppm-based precursor mass error' AS MS1_5D,
    MS2_1 + ' milliseconds| Median MS2 ion injection time for identified peptides' AS MS2_1,
    MS2_2 + '| Median S/N value for identified MS2 spectra' AS MS2_2,
    MS2_3 + '| Median number of peaks in all MS2 spectra' AS MS2_3,
    MS2_4A + '| Fraction of all MS2 spectra identified; low abundance quartile (determined using MS1 intensity of identified peptides)' AS MS2_4A,
    MS2_4B + '| Fraction of all MS2 spectra identified; second quartile (determined using MS1 intensity of identified peptides)' AS MS2_4B,
    MS2_4C + '| Fraction of all MS2 spectra identified; third quartile (determined using MS1 intensity of identified peptides)' AS MS2_4C,
    MS2_4D + '| Fraction of all MS2 spectra identified; high abundance quartile (determined using MS1 intensity of identified peptides)' AS MS2_4D,
    P_1A + '| Median peptide ID score (-Log10(MSGF_SpecProb) or X!Tandem hyperscore)' AS P_1A,
    P_1B + '| Median peptide ID score ( Log10(MSGF_SpecProb) or X!Tandem Peptide_Expectation_Value_Log(e))' AS P_1B,
    P_2A + '| Number of tryptic peptides; total spectra count' AS P_2A,
    P_2B + '| Number of tryptic peptides; unique peptide & charge count' AS P_2B,
    P_2C + '| Number of tryptic peptides; unique peptide count' AS P_2C,
    P_3 + '| Ratio of unique semi-tryptic / unique fully tryptic peptides' AS P_3,
    Phos_2A + '| Number of tryptic phosphopeptides; total spectra count' AS Phos_2A,
    Phos_2C + '| Number of tryptic phosphopeptides; unique peptide count' AS Phos_2C,
    Keratin_2A + '| Number of keratin peptides (full or partial trypsin); total spectra count' AS Keratin_2A,
    Keratin_2C + '| Number of keratin peptides (full or partial trypsin); unique peptide count' AS Keratin_2C,
    P_4A + '| Ratio of unique fully tryptic peptides / total unique peptides' AS P_4A,
    P_4B + '| Ratio of total missed cleavages (among unique peptides) / total unique peptides' AS P_4B,
    Trypsin_2A + '| Number of peptides from trypsin; total spectra count' AS Trypsin_2A,
    Trypsin_2C + '| Number of peptides from trypsin; unique peptide count' AS Trypsin_2C,
	MS2_RepIon_All + '| Number of peptides (PSMs) where all reporter ions were seen' AS MS2_RepIon_All,
	MS2_RepIon_1Missing + '| Number of peptides (PSMs) where all but 1 of the reporter ions were seen' AS MS2_RepIon_1Missing,
	MS2_RepIon_2Missing + '| Number of peptides (PSMs) where all but 2 of the reporter ions were seen' AS MS2_RepIon_2Missing,
	MS2_RepIon_3Missing + '| Number of peptides (PSMs) where all but 3 of the reporter ions were seen' AS MS2_RepIon_3Missing,
    SMAQC_Last_Affected,
    QCDM + '| Overall confidence using model developed by Brett Amidan' AS QCDM,
    QCDM_Last_Affected,
    MassErrorPPM,
    MassErrorPPM_Refined,
    MassErrorPPM_VIPER,
    AMTs_10pct_FDR,
    QCART + '| Overall confidence using model developed by Allison Thompson and Ryan Butner' AS QCART
	FROM (SELECT InstName.IN_Group AS [Instrument Group],
		   InstName.IN_name AS Instrument,
		   DS.Acq_Time_Start,
		   DQC.Dataset_ID,
		   DS.Dataset_Num AS Dataset,
		   DFP.Dataset_Folder_Path AS [Dataset Folder Path],
		   'http://prismsupport.pnl.gov/smaqc/index.php/smaqc/instrument/' + IN_Name AS 'QC Metric Stats',
		   DQC.Quameter_Job,
			dbo.NumberToString(DQC.XIC_WideFrac, 3) AS XIC_WideFrac,  
			dbo.NumberToString(DQC.XIC_FWHM_Q1, 3) AS XIC_FWHM_Q1,  
			dbo.NumberToString(DQC.XIC_FWHM_Q2, 3) AS XIC_FWHM_Q2,  
			dbo.NumberToString(DQC.XIC_FWHM_Q3, 3) AS XIC_FWHM_Q3,  
			dbo.NumberToString(DQC.XIC_Height_Q2, 3) AS XIC_Height_Q2,  
			dbo.NumberToString(DQC.XIC_Height_Q3, 3) AS XIC_Height_Q3,  
			dbo.NumberToString(DQC.XIC_Height_Q4, 3) AS XIC_Height_Q4,  
			dbo.NumberToString(DQC.RT_Duration, 3) AS RT_Duration,  
			dbo.NumberToString(DQC.RT_TIC_Q1, 3) AS RT_TIC_Q1,  
			dbo.NumberToString(DQC.RT_TIC_Q2, 3) AS RT_TIC_Q2,  
			dbo.NumberToString(DQC.RT_TIC_Q3, 3) AS RT_TIC_Q3,  
			dbo.NumberToString(DQC.RT_TIC_Q4, 3) AS RT_TIC_Q4,  
			dbo.NumberToString(DQC.RT_MS_Q1, 3) AS RT_MS_Q1,  
			dbo.NumberToString(DQC.RT_MS_Q2, 3) AS RT_MS_Q2,  
			dbo.NumberToString(DQC.RT_MS_Q3, 3) AS RT_MS_Q3,  
			dbo.NumberToString(DQC.RT_MS_Q4, 3) AS RT_MS_Q4,  
			dbo.NumberToString(DQC.RT_MSMS_Q1, 3) AS RT_MSMS_Q1,  
			dbo.NumberToString(DQC.RT_MSMS_Q2, 3) AS RT_MSMS_Q2,  
			dbo.NumberToString(DQC.RT_MSMS_Q3, 3) AS RT_MSMS_Q3,  
			dbo.NumberToString(DQC.RT_MSMS_Q4, 3) AS RT_MSMS_Q4,  
			dbo.NumberToString(DQC.MS1_TIC_Change_Q2, 3) AS MS1_TIC_Change_Q2,  
			dbo.NumberToString(DQC.MS1_TIC_Change_Q3, 3) AS MS1_TIC_Change_Q3,  
			dbo.NumberToString(DQC.MS1_TIC_Change_Q4, 3) AS MS1_TIC_Change_Q4,  
			dbo.NumberToString(DQC.MS1_TIC_Q2, 3) AS MS1_TIC_Q2,  
			dbo.NumberToString(DQC.MS1_TIC_Q3, 3) AS MS1_TIC_Q3,  
			dbo.NumberToString(DQC.MS1_TIC_Q4, 3) AS MS1_TIC_Q4,  
			dbo.NumberToString(DQC.MS1_Count, 0) AS MS1_Count,  
			dbo.NumberToString(DQC.MS1_Freq_Max, 3) AS MS1_Freq_Max,  
			dbo.NumberToString(DQC.MS1_Density_Q1, 0) AS MS1_Density_Q1,  
			dbo.NumberToString(DQC.MS1_Density_Q2, 0) AS MS1_Density_Q2,  
			dbo.NumberToString(DQC.MS1_Density_Q3, 0) AS MS1_Density_Q3,  
			dbo.NumberToString(DQC.MS2_Count, 0) AS MS2_Count,  
			dbo.NumberToString(DQC.MS2_Freq_Max, 3) AS MS2_Freq_Max,  
			dbo.NumberToString(DQC.MS2_Density_Q1, 0) AS MS2_Density_Q1,  
			dbo.NumberToString(DQC.MS2_Density_Q2, 0) AS MS2_Density_Q2,  
			dbo.NumberToString(DQC.MS2_Density_Q3, 0) AS MS2_Density_Q3,  
			dbo.NumberToString(DQC.MS2_PrecZ_1, 3) AS MS2_PrecZ_1,  
			dbo.NumberToString(DQC.MS2_PrecZ_2, 3) AS MS2_PrecZ_2,  
			dbo.NumberToString(DQC.MS2_PrecZ_3, 3) AS MS2_PrecZ_3,  
			dbo.NumberToString(DQC.MS2_PrecZ_4, 3) AS MS2_PrecZ_4,  
			dbo.NumberToString(DQC.MS2_PrecZ_5, 3) AS MS2_PrecZ_5,  
			dbo.NumberToString(DQC.MS2_PrecZ_more, 3) AS MS2_PrecZ_more,  
			dbo.NumberToString(DQC.MS2_PrecZ_likely_1, 3) AS MS2_PrecZ_likely_1,  
			dbo.NumberToString(DQC.MS2_PrecZ_likely_multi, 3) AS MS2_PrecZ_likely_multi,  
			DQC.Quameter_Last_Affected AS Quameter_Last_Affected,
			DQC.SMAQC_Job,
			dbo.NumberToString(DQC.C_1A, 3) AS C_1A,  
			dbo.NumberToString(DQC.C_1B, 3) AS C_1B,  
			dbo.NumberToString(DQC.C_2A, 3) AS C_2A,  
			dbo.NumberToString(DQC.C_2B, 3) AS C_2B,  
			dbo.NumberToString(DQC.C_3A, 3) AS C_3A,  
			dbo.NumberToString(DQC.C_3B, 3) AS C_3B,  
			dbo.NumberToString(DQC.C_4A, 3) AS C_4A,  
			dbo.NumberToString(DQC.C_4B, 3) AS C_4B,  
			dbo.NumberToString(DQC.C_4C, 3) AS C_4C,  
			dbo.NumberToString(DQC.DS_1A, 3) AS DS_1A,  
			dbo.NumberToString(DQC.DS_1B, 3) AS DS_1B,  
			dbo.NumberToString(DQC.DS_2A, 0) AS DS_2A,  
			dbo.NumberToString(DQC.DS_2B, 0) AS DS_2B,  
			dbo.NumberToString(DQC.DS_3A, 3) AS DS_3A,  
			dbo.NumberToString(DQC.DS_3B, 3) AS DS_3B,  
			dbo.NumberToString(DQC.IS_1A, 0) AS IS_1A,  
			dbo.NumberToString(DQC.IS_1B, 0) AS IS_1B,  
			dbo.NumberToString(DQC.IS_2, 3) AS IS_2,  
			dbo.NumberToString(DQC.IS_3A, 3) AS IS_3A,  
			dbo.NumberToString(DQC.IS_3B, 3) AS IS_3B,  
			dbo.NumberToString(DQC.IS_3C, 3) AS IS_3C,  
			dbo.NumberToString(DQC.MS1_1, 3) AS MS1_1,  
			dbo.NumberToString(DQC.MS1_2A, 3) AS MS1_2A,  
			dbo.NumberToString(DQC.MS1_2B, 3) AS MS1_2B,
			dbo.NumberToString(DQC.MS1_3A, 3) AS MS1_3A,
			dbo.NumberToString(DQC.MS1_3B, 3) AS MS1_3B,
			dbo.NumberToString(DQC.MS1_5A, 3) AS MS1_5A,
			dbo.NumberToString(DQC.MS1_5B, 3) AS MS1_5B,
			dbo.NumberToString(DQC.MS1_5C, 3) AS MS1_5C,
			dbo.NumberToString(DQC.MS1_5D, 3) AS MS1_5D,
			dbo.NumberToString(DQC.MS2_1, 3) AS MS2_1,
			dbo.NumberToString(DQC.MS2_2, 3) AS MS2_2,
			dbo.NumberToString(DQC.MS2_3, 0) AS MS2_3,
			dbo.NumberToString(DQC.MS2_4A, 3) AS MS2_4A,  
			dbo.NumberToString(DQC.MS2_4B, 3) AS MS2_4B,  
			dbo.NumberToString(DQC.MS2_4C, 3) AS MS2_4C,  
			dbo.NumberToString(DQC.MS2_4D, 3) AS MS2_4D,  
			dbo.NumberToString(DQC.P_1A, 3) AS P_1A,  
			dbo.NumberToString(DQC.P_1B, 3) AS P_1B,  
			dbo.NumberToString(DQC.P_2A, 0) AS P_2A,  
			dbo.NumberToString(DQC.P_2B, 0) AS P_2B,  
			dbo.NumberToString(DQC.P_2C, 0) AS P_2C,
			dbo.NumberToString(DQC.P_3, 3) AS P_3,
			dbo.NumberToString(DQC.Phos_2A, 0) AS Phos_2A,
			dbo.NumberToString(DQC.Phos_2C, 0) AS Phos_2C,
			dbo.NumberToString(DQC.Keratin_2A, 0) AS Keratin_2A,
			dbo.NumberToString(DQC.Keratin_2C, 0) AS Keratin_2C,
			dbo.NumberToString(DQC.P_4A, 3) AS P_4A,
			dbo.NumberToString(DQC.P_4B, 3) AS P_4B,
			dbo.NumberToString(DQC.Trypsin_2A, 0) AS Trypsin_2A,
			dbo.NumberToString(DQC.Trypsin_2C, 0) AS Trypsin_2C,
			dbo.NumberToString(DQC.MS2_RepIon_All, 0) AS MS2_RepIon_All,
			dbo.NumberToString(DQC.MS2_RepIon_1Missing, 0) AS MS2_RepIon_1Missing,
			dbo.NumberToString(DQC.MS2_RepIon_2Missing, 0) AS MS2_RepIon_2Missing,
			dbo.NumberToString(DQC.MS2_RepIon_3Missing, 0) AS MS2_RepIon_3Missing,
			DQC.Last_Affected AS SMAQC_Last_Affected,
			dbo.NumberToString(DQC.QCDM, 3) AS QCDM,  
			DQC.QCDM_Last_Affected,
			dbo.NumberToString(DQC.MassErrorPPM, 3) AS MassErrorPPM,  
			dbo.NumberToString(DQC.MassErrorPPM_Refined, 3) AS MassErrorPPM_Refined,  
			dbo.NumberToString(DQC.MassErrorPPM_VIPER, 3) AS MassErrorPPM_VIPER,  
			DQC.AMTs_10pct_FDR,
			dbo.NumberToString(DQC.QCART, 3) AS QCART
	FROM T_Dataset_QC DQC
		 INNER JOIN T_Dataset DS
		   ON DQC.Dataset_ID = DS.Dataset_ID
		 INNER JOIN T_Instrument_Name InstName
		   ON DS.DS_instrument_name_ID = InstName.Instrument_ID
		 LEFT OUTER JOIN dbo.V_Dataset_Folder_Paths DFP
		   ON DQC.Dataset_ID = DFP.Dataset_ID
	) DataQ



GO
GRANT VIEW DEFINITION ON [dbo].[V_Dataset_QC_Metrics_Detail_Report] TO [DDL_Viewer] AS [dbo]
GO
